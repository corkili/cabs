<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<title>土味订票</title>

	<meta charset="utf-8"/>
	<meta name="format-detection" content="telephone=no" />
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="page_name" content="index"/>

	<link rel="icon" th:href="@{images/favicon.ico}"/>
	<link rel="shortcut icon" th:href="@{images/favicon.ico}" />
	<link rel="stylesheet" th:href="@{booking/css/booking.css}"/>
	<link rel="stylesheet" th:href="@{css/camera.css}"/>
	<link rel="stylesheet" th:href="@{css/log_in.css}"/>
	<link rel="stylesheet" th:href="@{css/owl.carousel.css}"/>
	<link rel="stylesheet" th:href="@{css/style.css}"/>
	<!--<link rel="stylesheet" th:href="@{node_modules/sweetalert/dist/sweetalert.min.css}"/>-->
	<link rel="stylesheet" th:href="@{css/default.css}" />
	<link rel="stylesheet" th:href="@{css/component.css}" />
    <link rel="stylesheet" th:href="@{css/bootstrap.min.css}"/>

    <script th:src="@{js/jquery.js}"></script>
    <script th:src="@{js/jquery-migrate-1.2.1.js}"></script>
    <script th:src="@{js/script.js}"></script>
    <script th:src="@{js/superfish.js}"></script>
    <script th:src="@{js/jquery.ui.totop.js}"></script>
    <script th:src="@{js/jquery.equalheights.js}"></script>
    <script th:src="@{js/jquery.mobilemenu.js}"></script>
    <script th:src="@{js/jquery.easing.1.3.js}"></script>
    <script th:src="@{js/owl.carousel.js}"></script>
    <script th:src="@{js/camera.js}"></script>
    <script th:src="@{node_modules/sweetalert/dist/sweetalert.min.js}"></script>
    <script th:src="@{js/bootstrap.min.js}"></script>
    <!--[if (gt IE 9)|!(IE)]><!-->
    <script th:src="@{js/jquery.mobile.customized.min.js}"></script>
    <!--<![endif]-->
    <script th:src="@{booking/js/booking.js}"></script>
    <script th:src="@{js/modernizr.custom.js}"></script>
</head>
<body class="page1" id="top">
<!--==============================header=================================-->
<header th:replace="header :: header"></header>
<!--==============================header=================================-->
<div class="slider_wrapper">
	<div id="camera_wrap" class="">
		<div data-src="images/slide.jpg">
			<div class="caption fadeIn">

			</div>
		</div>
		<div data-src="images/slide1.jpg">
			<div class="caption fadeIn">

			</div>
		</div>
		<div data-src="images/slide2.jpg">
			<div class="caption fadeIn">

			</div>
		</div>
	</div>
</div>
<!--==============================Content=================================-->
<div class="content">
	<div class="container_12">
		<div class="grid_4">
			<div class="banner">
				<img th:src="@{images/ban_img1.jpg}" alt=""/>
				<div class="label">

				</div>
			</div>
		</div>
		<div class="grid_4">
			<div class="banner">
				<img th:src="@{images/ban_img2.jpg}" alt=""/>
				<div class="label">

				</div>
			</div>
		</div>
		<div class="grid_4">
			<div class="banner">
				<img th:src="@{images/ban_img3.jpg}" alt=""/>
				<div class="label">

				</div>
			</div>
		</div>
		<div class="clear"></div>
		<div class="grid_6">
			<h3>搜索航班</h3>
			<form id="bookingForm" method="post" th:action="@{search}">
				<div class="fl1">
					<div class="tmInput">
						<input type="text" class="form-control text1" id="departure" name="departure" placeholder="出发地"
							   list="departureList" data-toggle="tooltip" title="请选择列表中的地名" />
						<datalist id="departureList"></datalist>
					</div>
				</div>
				<div class="fl1">
					<div class="tmInput mr0">
						<input type="text" class="form-control text1" id="arrival" name="arrival" list="arrivalList"
							   data-toggle="tooltip" title="请选择列表中的地名" placeholder="目的地"/>
						<datalist id="arrivalList"></datalist>
					</div>
				</div>
				<div class="clear"></div>
				<strong>出发日期</strong>
				<label class="tmDatepicker">
					<input type="text" name="date" id="date" data-constraints="@NotEmpty @Required @Date" placeholder="出发日期"  data-toggle="tooltip" title="请选择今天以后的日期"/>
				</label>
				<div class="clear"></div>
				<div class="tmRadio">
					<p>舱位类型</p>
					<input name="cabin" type="radio" value="FIRST" id="tmRadio0" data-constraints='@RadioGroupChecked(name="Comfort", groups=[RadioGroup])'/>
					<span>头等舱</span>
					<input name="cabin" type="radio"  value="ECONOMY" id="tmRadio1" data-constraints='@RadioGroupChecked(name="Comfort", groups=[RadioGroup])' checked="checked" />
					<span>经济舱</span>
				</div>
				<a href="#" id="searchSubmit" class="btn" data-type="submit" style="width:84px;">搜索</a>
			</form>
		</div>
		<div class="grid_5 prefix_1">
			<h3>欢迎使用土味订票</h3>
			<img th:src="@{images/page1_img1.jpg}" alt="" class="img_inner fleft"/>
		</div>
	</div>
</div>
<!--==============================footer=================================-->
<footer style="background-color: #E74C3C">
	<div class="container_12" >
		<div class="grid_12">
			<div class="socials">
			</div>
			<div class="copy">
                Copyright © 2018 OldSchool Flight | 土味订票
			</div>
		</div>
	</div>
</footer>

<script>
    $(document).ready(function(){
        jQuery('#camera_wrap').camera({
            loader: false,
            pagination: false ,
            minHeight: '444',
            thumbnails: false,
            height: '48.375%',
            caption: true,
            navigation: true,
            fx: 'mosaic'
        });
        /*carousel*/
        var owl=$("#owl");
        owl.owlCarousel({
            items : 2, //10 items above 1000px browser width
            itemsDesktop : [995,2], //5 items between 1000px and 901px
            itemsDesktopSmall : [767, 2], // betweem 900px and 601px
            itemsTablet: [700, 2], //2 items between 600 and 0
            itemsMobile : [479, 1], // itemsMobile disabled - inherit from itemsTablet option
            navigation : true,
            pagination : false
        });
        $().UItoTop({ easingType: 'easeOutQuart' });
    });
</script>
<script>
    $(function (){
        $('#bookingForm').bookingForm({
            ownerEmail: '#'
        });
    });
    $(function() {
        $('#bookingForm input, #bookingForm textarea').placeholder();
    });

    $(function () {
        var addrArray = [];

        $("#searchSubmit").on('click', function () {
            var departure = $("#departure").val();
            var arrival = $("#arrival").val();
            var date = $("#date").val();
            var cabin = $("[name='cabin']:checked").val();
            var result = true;
            var curDate = new Date();
            var month = (curDate.getMonth() + 1) + '';
            var day = curDate.getDate() + '';
            var year = curDate.getFullYear() + '';
            if (2 > month.length) month = '0' + month;
            if (2 > day.length) day = '0' + day;
            curDate = new Date([year,month,day].join('-'));
            if (date == "" || date == null) {
                date = [month,day,year].join('/');
                $("#date").val(date);
            }
            var d = date.split('/');
            date = d[2] + '-' + d[0] + '-' + d[1];
            if (0 > addrArray.indexOf(departure)) {
                $("#departure").tooltip('show');
                result = false;
            }
            if (0 > addrArray.indexOf(arrival)) {
                $("#arrival").tooltip('show');
                result = false;
            }
            if (curDate > new Date(date)) {
                $("#date").tooltip('show');
                result = false;
            }
            if (result) {
                $("#bookingForm").submit();
            }
        });

        function createOption(value) {
            return '<option value="' + value + '"></option>';
        }

        $.ajax({
            url: 'address.json',
            method: 'get',
            success: function (data) {
                console.log(data);
                if (data == null) {
                    return;
                }
                var addresses = [];
                var temp = {
                    name: "直辖市/特别行政区",
                    sub: [{
                        name: "请选择",
                        sub: []
                    }],
                    type: 1
                };
                $.each(data, function (index, content) {
                    if (content.type == 0) {
                        temp.sub.push(content);
                    } else {
                        addresses.push(content);
                    }
                });
                temp.sub.splice(temp.sub.length - 1, 1);
                addresses.splice(1, 0, temp);
                addresses.splice(addresses.length - 1, 1);
                console.log(addresses);

                $.each(addresses, function (pi, p) {
                    if (pi != 0) {
                        if (pi == 1) {
                            $.each(p.sub, function (ci, c) {
                                if (!(ci == 0 || c.name == '其他')) {
                                    addrArray.push(c.name);
                                }
                            })
                        } else {
                            $.each(p.sub, function (ci, c) {
                                if (!(ci == 0 || c.name == '其他')) {
                                    addrArray.push(p.name + '-' + c.name);
                                }
                            })
                        }
                    }
                });
                console.log(addrArray);
                $.each(addrArray, function (i, a) {
                    $("#departureList,#arrivalList").append(createOption(a));
                });

            }
        });
    })
</script>

</body>
</html>

